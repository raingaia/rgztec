<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>RGZTEC ‚Ä¢ Store</title>
<meta name="description" content="Store page. Global header + store-specific content; products added by sellers via localStorage."/>

<style>
  :root { --text:#111827; --icon:#6b7280; --hover:#0b0b0b; --line:#d1d5db;
          --studio-bg:#1f2937; --rgztec:#f97316; --rgztec-dark:#ea580c; --light:#fff; }

  *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;color:var(--text);background:#fff}

  /* ===== Global Header (index.html ile aynƒ± g√∂r√ºn√ºm) ===== */
  .topbar{background:#fff}
  .wrap{max-width:1200px;margin:0 auto;padding:10px 16px;display:flex;align-items:center;gap:16px}
  .brand{font-weight:800;font-size:22px;color:var(--rgztec);text-decoration:none}
  .studio{font-weight:600;font-size:16px;background:var(--studio-bg);color:#fff;padding:4px 10px;border-radius:8px;line-height:1}
  .search{flex:1;display:flex;gap:8px;max-width:760px;margin-left:6px;border:2px solid #111827;border-radius:999px;padding:6px 8px 6px 12px;background:#fff}
  .search input{flex:1;border:0;outline:0;font-size:15px;padding:6px 8px}
  .search button{border:0;background:none;color:var(--icon);font-size:16px;cursor:pointer;padding:0 10px}
  .icons{display:flex;gap:14px;align-items:center}
  .icons a{text-decoration:none;color:var(--icon);font-size:16px}
  .open-store{background:var(--rgztec);color:#fff !important;font-weight:600;padding:7px 18px;border-radius:999px;
              box-shadow:0 2px 4px rgba(0,0,0,.1);transition:all .2s}
  .open-store:hover{background:var(--rgztec-dark);transform:translateY(-1px);box-shadow:0 4px 6px rgba(0,0,0,.15)}

  /* Global kategori barƒ± (index header‚Äôƒ±ndaki satƒ±r) */
  .global-cats{max-width:1200px;margin:0 auto;display:flex;justify-content:center;flex-wrap:wrap;gap:28px;padding:6px 16px 10px;border-bottom:1px solid var(--line)}
  .global-cats a{color:var(--text);text-decoration:none;font-weight:500;font-size:15px;position:relative;padding:4px;transition:.2s}
  .global-cats a:hover{color:var(--hover)}
  .global-cats a::after{content:"";position:absolute;left:0;right:0;bottom:-3px;height:2px;background:transparent;transition:.2s}
  .global-cats a:hover::after{background:var(--hover)}

  /* √úst a√ßƒ±klama (store tagline) */
  .intro{max-width:1200px;margin:14px auto 0;padding:0 16px;color:#475569;font-size:15px}

  /* Store‚Äôa √∂zel kategori linkleri */
  .categories{max-width:1200px;margin:8px auto 0;display:flex;justify-content:center;flex-wrap:wrap;gap:28px;padding:6px 16px 10px}
  .categories a{color:var(--text);text-decoration:none;font-weight:500;font-size:15px;position:relative;padding:4px;transition:.2s}
  .categories a:hover{color:var(--hover)}
  .categories a::after{content:"";position:absolute;left:0;right:0;bottom:-3px;height:2px;background:transparent;transition:.2s}
  .categories a:hover::after{background:var(--hover)}

  .divider{border:none;border-top:1px solid var(--line);margin:10px 0 0;width:100%}

  /* Toolbar + grid */
  .container{max-width:1200px;margin:0 auto;padding:16px}
  .toolbar{display:flex;gap:10px;align-items:center;margin:18px 0 10px}
  .toolbar input{flex:1 1 320px;border:1px solid var(--line);border-radius:12px;padding:10px 12px}
  .btn{border:1px solid var(--line);background:#fff;border-radius:12px;padding:10px 14px;cursor:pointer}
  .btn.primary{background:var(--rgztec);border-color:var(--rgztec);color:#fff}
  .grid{display:grid;grid-template-columns:repeat(auto-fill, minmax(220px,1fr));gap:16px}
  .card{border:1px solid var(--line);border-radius:14px;overflow:hidden}
  .thumb{aspect-ratio:16/10;background:#f1f5f9;background-size:cover;background-position:center}
  .card-body{padding:12px;display:flex;flex-direction:column;gap:6px}
  .card h3{font-size:16px;margin:0}
  .muted{color:#6b7280;font-size:13px}
  .empty{border:2px dashed var(--line);border-radius:12px;padding:24px;text-align:center;color:#6b7280;margin-top:10px}

  /* Modal */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.4);display:none;align-items:center;justify-content:center;padding:16px}
  .modal.show{display:flex}
  .sheet{background:#fff;max-width:560px;width:100%;border-radius:16px;padding:18px;border:1px solid var(--line)}
  .sheet h2{margin:0 0 10px}
  .form{display:grid;gap:10px;margin-top:6px}
  .form input,.form textarea{padding:10px 12px;border:1px solid var(--line);border-radius:10px;width:100%}
  .row{display:flex;gap:10px}
</style>
</head>
<body>

<!-- ===== GLOBAL HEADER ===== -->
<header class="topbar">
  <div class="wrap">
    <a class="brand" href="./">RGZTEC</a>

    <!-- Bu pill slug‚Äôa g√∂re deƒüi≈üecek -->
    <span id="studioName" class="studio">Dev One Studio</span>

    <form class="search" onsubmit="return false;">
      <input id="q" type="search" placeholder="Search for anything" aria-label="Search"/>
      <button type="submit" aria-label="Search" id="qBtn">üîç</button>
    </form>

    <nav class="icons" aria-label="Quick actions">
      <a href="login" aria-label="Sign in">Sign in</a>
      <a href="#" title="Gifts" aria-label="Gifts">üéÅ</a>
      <a href="cart" title="Cart" aria-label="Cart">üõí</a>
      <a href="become-seller" class="open-store" aria-label="Open your store">Open Store</a>
    </nav>
  </div>

  <!-- Global kategori satƒ±rƒ± -->
  <nav class="global-cats" aria-label="Global Categories">
    <a href="#">Web Templates</a>
    <a href="#">E-commerce / Marketplace</a>
    <a href="#">Widgets & Components</a>
    <a href="#">Software & Automation</a>
    <a href="#">Niche / Specialized Packs</a>
  </nav>
</header>

<!-- Maƒüaza a√ßƒ±klamasƒ± (slug‚Äôa g√∂re) -->
<p id="intro" class="intro"></p>

<!-- Store‚Äôa √∂zel kategoriler -->
<nav id="catNav" class="categories" aria-label="Store Categories"></nav>

<hr class="divider"/>

<!-- TOOLBAR + GRID -->
<section class="container">
  <div class="toolbar">
    <input id="searchInput" placeholder="Search products‚Ä¶"/>
    <button id="addProductBtn" class="btn">Add Product</button>
  </div>

  <div id="productGrid" class="grid"></div>
  <div id="emptyState" class="empty">No products yet. Click <b>Add Product</b> to create one.</div>
</section>

<!-- Add Product Modal -->
<div id="productModal" class="modal" aria-hidden="true">
  <div class="sheet">
    <h2>Add Product</h2>
    <div class="form">
      <input id="pStore" placeholder="Store slug" readonly />
      <input id="pTitle" placeholder="Product title"/>
      <input id="pSlug" placeholder="Product slug (auto if empty)"/>
      <textarea id="pDesc" placeholder="Short description"></textarea>
      <input id="pImage" placeholder="Image URL (e.g., images/placeholder.png)"/>
      <div class="row" style="justify-content:flex-end">
        <button class="btn" id="pCancel">Cancel</button>
        <button class="btn primary" id="pCreate">Add</button>
      </div>
    </div>
  </div>
</div>

<script>
  // ------- CONFIG & HELPERS -------
  const LS_PRODUCTS = 'rgz_products_user';
  const getUserProducts = () => JSON.parse(localStorage.getItem(LS_PRODUCTS) || '[]');
  const setUserProducts = v => localStorage.setItem(LS_PRODUCTS, JSON.stringify(v));

  // T√ºrk√ße karakter dostu slugify
  function slugify(text=''){
    const map = { '√ß':'c','ƒü':'g','ƒ±':'i','i':'i','√∂':'o','≈ü':'s','√º':'u',
                  '√á':'c','ƒû':'g','ƒ∞':'i','I':'i','√ñ':'o','≈û':'s','√ú':'u' };
    return text.toString()
      .replace(/[\u00C0-\u024F]/g, ch => map[ch] || ch) // temel d√∂n√º≈üt√ºrme
      .toLowerCase()
      .replace(/\s+/g,'-')
      .replace(/[^\w\-]+/g,'')   // \w: a-z0-9_ (T√ºrk√ße harfler artƒ±k d√∂n√º≈üt√ºƒü√º i√ßin sorun yok)
      .replace(/\-\-+/g,'-')
      .replace(/^-+/, '')
      .replace(/-+$/, '');
  }

  const params = new URLSearchParams(location.search);
  const storeSlug = (params.get('slug') || '').trim();

  // ------- HEADER + CONTENT BY SLUG -------
  (async function initHeader(){
    if (!storeSlug) return;
    try {
      const sres = await fetch('data/stores.json', { cache: 'no-store' });
      if (sres.ok){
        const { stores=[] } = await sres.json();
        const meta = stores.find(s=>s.slug===storeSlug);
        if (meta){
          const nameEl = document.getElementById('studioName');
          nameEl.textContent = meta.name || meta.slug;
          if (meta.color) nameEl.style.background = meta.color;
          document.title = `RGZTEC ‚Ä¢ ${meta.name || meta.slug}`;
        }
      }
      const cres = await fetch('data/store-content.json', { cache: 'no-store' });
      if (cres.ok){
        const content = await cres.json();
        const entry = content[storeSlug] || {};
        document.getElementById('intro').textContent = entry.tagline || '';
        const cats = Array.isArray(entry.categories) ? entry.categories : [];
        document.getElementById('catNav').innerHTML = cats.map(c=>`<a href="#">${escapeHtml(c)}</a>`).join('');
      }
    } catch(e){ console.warn(e); }
  })();

  // ------- PRODUCTS -------
  function listProducts(){
    const staticList = Array.isArray(window.products) ? window.products : [];
    const userList = getUserProducts();
    return [...staticList, ...userList].filter(p => p.store === storeSlug);
  }

  function renderProducts(items){
    const grid = document.getElementById('productGrid');
    const empty = document.getElementById('emptyState');
    grid.innerHTML = '';
    if (!items.length){
      empty.style.display = 'block';
      return;
    }
    empty.style.display = 'none';
    for (const p of items){
      const card = document.createElement('article');
      card.className = 'card';
      card.innerHTML = `
        <div class="thumb" style="background-image:url('${p.image || ''}')"></div>
        <div class="card-body">
          <h3>${escapeHtml(p.title || 'Untitled')}</h3>
          <div class="muted">${escapeHtml(p.desc || '')}</div>
        </div>
      `;
      grid.appendChild(card);
    }
  }

  function escapeHtml(s=''){return s.replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));}

  // Search
  function applySearch(){
    const q = (document.getElementById('searchInput').value || '').toLowerCase();
    const list = listProducts().filter(p =>
      (p.title||'').toLowerCase().includes(q) ||
      (p.desc||'').toLowerCase().includes(q)
    );
    renderProducts(list);
  }

  // ------- MODAL + CREATE PRODUCT -------
  const productModal = document.getElementById('productModal');
  function openProductModal(show){ productModal.classList.toggle('show', !!show); }
  function prefillProductModal(){
    document.getElementById('pStore').value = storeSlug;
    document.getElementById('pTitle').value = '';
    document.getElementById('pSlug').value = '';
    document.getElementById('pDesc').value = '';
    document.getElementById('pImage').value = '';
  }
  function createProduct(){
    const store = document.getElementById('pStore').value.trim();
    const title = document.getElementById('pTitle').value.trim();
    let   pslug = document.getElementById('pSlug').value.trim();
    const desc  = document.getElementById('pDesc').value.trim();
    const image = document.getElementById('pImage').value.trim() || 'images/placeholder.png';

    if (!store || !title){ alert('Store slug and title are required.'); return; }
    if (!pslug) pslug = slugify(title);

    const list = getUserProducts();
    const id = `${store}-${Date.now()}`;
    list.push({ id, store, slug: pslug, title, desc, image });
    setUserProducts(list);

    openProductModal(false);
    renderProducts(listProducts());
  }

  // ------- WIRE UI -------
  (function init(){
    // ƒ∞lk render
    renderProducts(listProducts());

    // Search
    document.getElementById('searchInput').addEventListener('keydown', e => { if (e.key==='Enter') applySearch(); });
    document.getElementById('qBtn').addEventListener('click', e => { e.preventDefault(); applySearch(); });

    // Add Product
    document.getElementById('addProductBtn').addEventListener('click', () => { prefillProductModal(); openProductModal(true); });
    document.getElementById('pCancel').addEventListener('click', () => openProductModal(false));
    document.getElementById('pCreate').addEventListener('click', createProduct);
  })();
</script>
</body>
</html>
