<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>RGZTEC ‚Ä¢ Store</title>
<style>
  :root{
    --wrap:1280px; --rail-w:980px; --search-h:44px;
    --ink:#0b1220; --muted:#6b7280;
    --line:#e5e7eb; --line-strong:#cbd5e1;
    --brand:#f97316; --brand-dark:#ea580c;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;color:var(--ink);background:#fff}

  .wrap{max-width:var(--wrap);margin:0 auto;padding:12px 18px 0}
  .hdr{display:grid;grid-template-columns:1fr minmax(0,var(--rail-w)) 1fr;align-items:center;gap:16px}
  .left{display:flex;align-items:center;gap:10px}
  .brand{font-weight:900;font-size:22px;color:var(--brand);text-decoration:none}
  .studio{white-space:nowrap;line-height:1;font-weight:800;font-size:14px;color:#fff;background:#7c3aed;padding:6px 10px;border-radius:999px}

  .rail{display:flex;justify-content:center}
  .search{width:var(--rail-w);max-width:100%;display:flex;align-items:center;gap:8px;height:var(--search-h);padding:6px 8px 6px 14px;border:2px solid #111827;border-radius:999px;background:#fff}
  .search input{flex:1;border:0;outline:0;font-size:15px;padding:8px 6px;background:transparent}
  .search button{display:grid;place-items:center;width:34px;height:34px;border-radius:999px;border:0;background:var(--brand);cursor:pointer}
  .search svg{width:18px;height:18px;stroke:#fff;fill:none;stroke-width:2}

  .icons{display:flex;gap:12px;justify-content:flex-end;align-items:center}
  .icons a{color:var(--muted);text-decoration:none;font-size:14px;white-space:nowrap}
  .open{background:var(--brand);color:#fff !important;font-weight:700;padding:8px 16px;border-radius:999px}
  .open:hover{background:var(--brand-dark)}

  .bar-wrap{border-bottom:2px solid var(--line-strong)}
  .bar{max-width:var(--rail-w);margin:2px auto 0;display:grid;grid-template-columns:repeat(5,1fr);align-items:center}
  .bar a{line-height:44px;text-align:center;font-weight:600;text-decoration:none;color:var(--ink)}
  .bar a[aria-current="page"]{color:var(--brand-dark);text-decoration:underline}

  .btn-cats{display:inline-flex;align-items:center;gap:8px;height:40px;padding:0 14px;border:1px solid var(--line-strong);border-radius:12px;background:#fff;cursor:pointer}
  .btn-cats svg{width:18px;height:18px}

  main{max-width:var(--wrap);margin:16px auto;padding:0 18px}
  .empty{color:var(--muted)}

  /* Drawer */
  .drawer{position:fixed;inset:0;display:none;z-index:9999}
  .drawer.open{display:block}
  .back{position:absolute;inset:0;background:transparent}
  .panel{
    position:absolute;width:280px;background:#fff;border-radius:12px;
    box-shadow:0 8px 24px rgba(0,0,0,.15);border:1px solid var(--line);
    padding:8px;max-height:calc(100vh - 80px);overflow:auto
  }
  .panel h4{margin:6px 8px 8px;font-size:13px;color:var(--muted)}
  .panel a{display:block;padding:10px 12px;border-radius:8px;color:var(--ink);text-decoration:none;font-weight:500;font-size:14px}
  .panel a:hover{background:#f3f4f6}

  @media (max-width:900px){
    .hdr{grid-template-columns:1fr}
    .icons a:not(.open){display:none}
    .bar{grid-template-columns:repeat(auto-fit,minmax(120px,1fr))}
  }
</style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="hdr">
      <div class="left">
        <a class="brand" href="./">RGZTEC</a>
        <span id="studio" class="studio">Store</span>
        <button id="btnCats" class="btn-cats" aria-haspopup="dialog" aria-expanded="false">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 6h16M4 12h16M4 18h16"/></svg>
          <span>Categories</span>
        </button>
      </div>

      <div class="rail">
        <form id="searchForm" class="search" role="search">
          <input id="q" type="search" placeholder="Search for anything" aria-label="Search"/>
          <button type="submit" aria-label="Search">
            <svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="6"/><path d="M16.5 16.5 21 21"/></svg>
          </button>
        </form>
      </div>

      <nav class="icons">
        <a href="login">Sign in</a>
        <a href="#" title="Gifts">üéÅ</a>
        <a href="cart" title="Cart">üõí</a>
        <a href="become-seller" class="open">Open Store</a>
      </nav>
    </div>
  </div>

  <div class="bar-wrap">
    <nav id="bar" class="bar" aria-label="Store categories"></nav>
  </div>
</header>

<main>
  <p class="empty">Page content starts here‚Ä¶</p>
</main>

<!-- Drawer -->
<div id="drawer" class="drawer" aria-hidden="true">
  <div id="back" class="back"></div>
  <aside class="panel" role="dialog" aria-label="Categories">
    <h4>Categories</h4>
    <nav id="drawerNav"></nav>
    <a id="allCats" href="listings.html" style="margin:6px 8px 0;color:var(--brand);font-weight:700;">All Categories ‚Üí</a>
  </aside>
</div>

<script>
  const params = new URLSearchParams(location.search);
  const slug = (params.get('slug') || '').trim();
  const $ = (s, r=document) => r.querySelector(s);
  const esc = s => String(s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m]));
  const slugify = s => String(s||'').toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');

  (async function init(){
    if(!slug) return;

    // maƒüaza adƒ±/renk
    try{
      const sres = await fetch('data/stores.json', {cache:'no-store'});
      if(sres.ok){
        const {stores=[]} = await sres.json();
        const meta = stores.find(x=>x.slug===slug);
        if(meta){
          $('#studio').textContent = meta.name || meta.slug;
          $('#studio').style.background = meta.color || '#7c3aed';
          document.title = `RGZTEC ‚Ä¢ ${meta.name || meta.slug}`;
        }else{
          $('#studio').textContent = slug;
          document.title = `RGZTEC ‚Ä¢ ${slug}`;
        }
      }
    }catch(e){}

    // maƒüaza kategorileri
    try{
      const cres = await fetch('data/store-content.json', {cache:'no-store'});
      if(!cres.ok) return;
      const content = await cres.json();
      const entry = content[slug] || {};
      const cats = Array.isArray(entry.categories) ? entry.categories : [];

      // √ºst bar
      const bar = $('#bar');
      bar.style.gridTemplateColumns = `repeat(${Math.max(1,cats.length)},1fr)`;
      bar.innerHTML = cats.map(c=>{
        const h = slugify(c);
        return `<a href="store.html?slug=${encodeURIComponent(slug)}#${h}" data-hash="${h}">${esc(c)}</a>`;
      }).join('');

      const setActive = ()=>{
        const cur = (location.hash||'').slice(1);
        bar.querySelectorAll('a').forEach(a=>{
          if(a.dataset.hash===cur) a.setAttribute('aria-current','page');
          else a.removeAttribute('aria-current');
        });
      };
      setActive();
      window.addEventListener('hashchange', setActive);

      // drawer doldur
      $('#drawerNav').innerHTML = cats.map(c=>{
        const h = slugify(c);
        return `<a href="store.html?slug=${encodeURIComponent(slug)}#${h}">${esc(c)}</a>`;
      }).join('');
      $('#allCats').href = `listings.html?tag=${encodeURIComponent(slug)}`;
    }catch(e){}
  })();

  // Drawer a√ß/kapa ‚Äî kesin a√ßƒ±lmasƒ± i√ßin √∂nce g√∂r√ºnmez bi√ßimde √∂l√ß, sonra konumlandƒ±r
  const drawer = $('#drawer'), panel = $('.panel', drawer), back = $('#back'), btn = $('#btnCats');

  function positionPanel(){
    const r = btn.getBoundingClientRect();
    // panel geni≈üliƒüini doƒüru √∂l√ßmek i√ßin ge√ßici g√∂r√ºn√ºr yap
    panel.style.visibility = 'hidden';
    panel.style.display = 'block';
    const pw = panel.offsetWidth;
    panel.style.display = ''; // eski hale
    panel.style.visibility = '';

    const margin = 8;
    const left = Math.min(
      Math.max(margin, r.left + window.scrollX),
      window.innerWidth + window.scrollX - pw - margin
    );
    const top = r.bottom + window.scrollY + margin;

    panel.style.left = left + 'px';
    panel.style.top  = top  + 'px';
  }

  function openDrawer(){
    positionPanel();
    drawer.classList.add('open');
    drawer.setAttribute('aria-hidden','false');
    btn.setAttribute('aria-expanded','true');
  }
  function closeDrawer(){
    drawer.classList.remove('open');
    drawer.setAttribute('aria-hidden','true');
    btn.setAttribute('aria-expanded','false');
  }

  btn?.addEventListener('click', (e)=>{ e.stopPropagation(); drawer.classList.contains('open')?closeDrawer():openDrawer(); });
  back?.addEventListener('click', closeDrawer);
  window.addEventListener('keydown', e=>{ if(e.key==='Escape') closeDrawer(); });
  window.addEventListener('resize', ()=>{ if(drawer.classList.contains('open')) positionPanel(); });

  // arama: slug + hash korunur
  $('#searchForm')?.addEventListener('submit', (e)=>{
    e.preventDefault();
    const q = ($('#q')?.value||'').trim();
    const hash = location.hash || '';
    location.href = `store.html?slug=${encodeURIComponent(slug)}${q?`&q=${encodeURIComponent(q)}`:''}${hash}`;
  });
</script>
</body>
</html>
