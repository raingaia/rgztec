<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>RGZTEC • Playground</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<style>
  :root{--brand:#f97316}
  body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
  .code{background:#0b1220;color:#e5e7eb;padding:14px;border-radius:12px;overflow:auto;font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;font-size:12px;white-space:pre-wrap}
  .hint{font-size:12px;color:#92400e;background:#fffbeb;border:1px solid #fde68a;border-radius:10px;padding:6px 10px;margin-top:8px;display:none}
  .hint.show{display:block}
</style>
</head>
<body class="bg-gray-50 text-gray-900">
  <div class="max-w-5xl mx-auto p-6">
    <header class="flex items-center justify-between">
      <h1 class="text-2xl font-extrabold">RGZTEC <span class="text-orange-500">Playground</span></h1>
      <a href="./index.html" class="px-3 py-2 rounded bg-gray-900 text-white">Back to Site</a>
    </header>

    <section class="mt-6 grid md:grid-cols-2 gap-6">
      <div class="bg-white rounded-xl shadow p-4">
        <h2 class="font-semibold mb-2">Edit code</h2>
        <pre id="codeBlock" class="code" contenteditable="true" aria-label="Edit code here">
&lt;button class=&quot;cta&quot;&gt;Buy&lt;/button&gt;
&lt;style&gt;.cta{background:#f97316;color:#fff;padding:10px 16px;border:none;border-radius:10px;font-weight:600}&lt;/style&gt;
&lt;script&gt;
  document.addEventListener('DOMContentLoaded', () =&gt; {
    const btn = document.querySelector('.cta');
    if(btn) btn.onclick = () =&gt; alert('Purchased!');
  });
&lt;/script&gt;
        </pre>

        <div class="flex flex-wrap gap-2 mt-3">
          <button class="px-4 py-2 rounded bg-orange-500 text-white" onclick="copyCode()">Copy Code</button>
          <button class="px-4 py-2 rounded bg-gray-900 text-white" onclick="runPreview()">Run (Preview)</button>
          <button class="px-4 py-2 rounded bg-gray-900 text-white" onclick="openInNewTab()">Open in New Tab</button>
        </div>
        <p id="popupWarn" class="hint">Pop-up engellendi. Lütfen bu site için pop-uplara izin verip tekrar deneyin.</p>
      </div>

      <div class="bg-white rounded-xl shadow p-4">
        <h2 class="font-semibold mb-2">Preview</h2>
        <div id="preview" class="border rounded-xl p-4 min-h-40"></div>
      </div>
    </section>
  </div>

<script>
  const getCode = () => document.getElementById('codeBlock').innerText.trim();

  function copyCode(){
    navigator.clipboard.writeText(getCode())
      .then(()=>alert('Copied!'))
      .catch(()=>alert('Copy failed'));
  }

  function runPreview(){
    const html = getCode();
    const mount = document.getElementById('preview');
    mount.innerHTML = ''; // temizle

    // wrapper içine yerleştir
    const wrapper = document.createElement('div');
    wrapper.innerHTML = html;

    // script dışı nodeları ekle
    Array.from(wrapper.childNodes).forEach(node => {
      if (!(node.tagName && node.tagName.toLowerCase() === 'script')) {
        mount.appendChild(node);
      }
    });

    // scriptleri aktif ekle
    wrapper.querySelectorAll('script').forEach(old => {
      const s = document.createElement('script');
      if (old.src) { s.src = old.src; s.async = false; }
      else { s.textContent = old.textContent; }
      mount.appendChild(s);
    });
  }

  function openInNewTab(){
    const warn = document.getElementById('popupWarn');
    warn.classList.remove('show');

    const snippet = getCode();
    const htmlDoc = `<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>RGZTEC Snippet</title>
</head><body>${snippet}</body></html>`;

    // 1) Doğrudan yeni sekmeye yaz
    const win = window.open('', '_blank');
    if (win && win.document) {
      win.document.open(); win.document.write(htmlDoc); win.document.close(); return;
    }
    // 2) Blob fallback
    try {
      const blob = new Blob([htmlDoc], {type:'text/html'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.target='_blank'; a.rel='noopener';
      document.body.appendChild(a); a.click(); a.remove();
      setTimeout(()=>URL.revokeObjectURL(url), 30000);
    } catch { warn.classList.add('show'); }
  }

  // İlk açılışta bir önizleme yap
  runPreview();
</script>
</body>
</html>

