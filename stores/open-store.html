<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RGZTEC • Open Store</title>
  <!-- Tailwind CDN (play) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Tailwind config (optional brand tokens)
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            text: '#111827',
            icon: '#6b7280',
            line: '#e5e7eb',
            brand: {
              50: '#eef2ff', 100: '#e0e7ff', 200: '#c7d2fe', 300: '#a5b4fc',
              400: '#818cf8', 500: '#6366f1', 600: '#4f46e5', 700: '#4338ca',
              800: '#3730a3', 900: '#312e81'
            }
          },
          boxShadow: {
            soft: '0 8px 24px rgba(0,0,0,.08)'
          },
          borderRadius: {
            '2xl': '1rem'
          }
        }
      }
    }
  </script>
  <style>
    :root{
      --wrap: 1280px;
    }
    .wrap{max-width:var(--wrap); margin-inline:auto}
  </style>
</head>
<body class="bg-white text-text">
  <!-- Top bar -->
  <header class="border-b border-line sticky top-0 bg-white/80 backdrop-blur z-40">
    <div class="wrap px-4 py-3 flex items-center gap-4">
      <a id="linkHome" href="#" class="font-semibold tracking-tight text-lg">RGZTEC</a>
      <div class="ml-auto flex items-center gap-2">
        <a id="linkStores" href="#" class="text-sm text-icon hover:text-text">Stores</a>
        <a id="linkOpenStore" href="#" class="text-sm text-icon hover:text-text">Open Store</a>
      </div>
    </div>
  </header>

  <main class="wrap px-4 py-8">
    <!-- Hero -->
    <section class="mb-8">
      <h1 class="text-3xl md:text-4xl font-bold tracking-tight">Open Store</h1>
      <p class="mt-2 text-icon max-w-2xl">Create your seller profile, set up your shop, import products and publish — all in a few minutes. This MVP is HTML + vanilla JS and ready to wire into Firebase when you are.</p>
    </section>

    <!-- Progress / Steps -->
    <ol id="steps" class="grid md:grid-cols-5 gap-3 mb-6">
      <li data-step="1" class="step active"><div class="p-3 border border-line rounded-2xl shadow-soft"><div class="text-xs text-icon">Step 1</div><div class="font-medium">Seller</div></div></li>
      <li data-step="2" class="step"><div class="p-3 border border-line rounded-2xl"><div class="text-xs text-icon">Step 2</div><div class="font-medium">Store</div></div></li>
      <li data-step="3" class="step"><div class="p-3 border border-line rounded-2xl"><div class="text-xs text-icon">Step 3</div><div class="font-medium">Payments</div></div></li>
      <li data-step="4" class="step"><div class="p-3 border border-line rounded-2xl"><div class="text-xs text-icon">Step 4</div><div class="font-medium">Products</div></div></li>
      <li data-step="5" class="step"><div class="p-3 border border-line rounded-2xl"><div class="text-xs text-icon">Step 5</div><div class="font-medium">Review</div></div></li>
    </ol>

    <!-- Forms container -->
    <div id="panes" class="space-y-6">
      <!-- 1. Seller Profile -->
      <form id="pane-1" class="pane grid md:grid-cols-2 gap-6" onsubmit="event.preventDefault(); goto(2)">
        <div class="p-6 border border-line rounded-2xl shadow-soft">
          <h2 class="text-xl font-semibold mb-4">Seller profile</h2>
          <div class="grid gap-3">
            <label class="grid gap-1">
              <span class="text-sm">Full name / Company</span>
              <input name="sellerName" required class="input" placeholder="RAINGAIA LLC" />
            </label>
            <label class="grid gap-1">
              <span class="text-sm">Email</span>
              <input type="email" name="sellerEmail" required class="input" placeholder="you@company.com" />
            </label>
            <label class="grid gap-1">
              <span class="text-sm">Phone (optional)</span>
              <input name="sellerPhone" class="input" placeholder="+1 555 000 0000" />
            </label>
            <label class="grid gap-1">
              <span class="text-sm">Country</span>
              <input name="sellerCountry" class="input" placeholder="Türkiye / United States" />
            </label>
          </div>
          <div class="mt-4 flex items-center justify-end gap-3">
            <button type="button" class="btn ghost" onclick="resetAll()">Reset</button>
            <button class="btn">Continue</button>
          </div>
        </div>
        <aside class="p-6 border border-line rounded-2xl">
          <h3 class="font-medium mb-2">Why we need this</h3>
          <p class="text-sm text-icon">This info builds your seller record in Firestore. KYC/KYB comes later when you connect payments.</p>
          <ul class="mt-3 text-sm list-disc pl-5 text-icon">
            <li>Name & contact for invoices</li>
            <li>Country for tax rules</li>
          </ul>
        </aside>
      </form>

      <!-- 2. Store Setup -->
      <form id="pane-2" class="pane hidden grid md:grid-cols-2 gap-6" onsubmit="event.preventDefault(); goto(3)">
        <div class="p-6 border border-line rounded-2xl shadow-soft">
          <h2 class="text-xl font-semibold mb-4">Store setup</h2>
          <div class="grid gap-3">
            <label class="grid gap-1">
              <span class="text-sm">Store name</span>
              <input name="storeName" required class="input" placeholder="Dev One Studio" />
            </label>
            <label class="grid gap-1">
              <span class="text-sm">Public URL slug</span>
              <div class="flex items-center gap-2">
                <span class="text-sm text-icon">/store/</span>
                <input name="storeSlug" required class="input" placeholder="dev-one-studio" />
              </div>
            </label>
            <label class="grid gap-1">
              <span class="text-sm">Category</span>
              <select name="storeCategory" class="input">
                <option>Software & Code</option>
                <option>Health & Kits</option>
                <option>Design Assets</option>
                <option>Electronics</option>
                <option>Other</option>
              </select>
            </label>
            <label class="grid gap-1">
              <span class="text-sm">Short bio</span>
              <textarea name="storeBio" rows="3" class="input" placeholder="We build professional templates and tools."></textarea>
            </label>
            <label class="grid gap-1">
              <span class="text-sm">Brand color</span>
              <input type="color" name="brandColor" class="h-10 w-16 p-0 border border-line rounded" value="#6366f1" />
            </label>
          </div>
          <div class="mt-4 flex items-center justify-between">
            <button type="button" class="btn ghost" onclick="goto(1)">Back</button>
            <button class="btn">Continue</button>
          </div>
        </div>
        <aside class="p-6 border border-line rounded-2xl">
          <h3 class="font-medium mb-2">Preview</h3>
          <div id="storePreview" class="p-4 border border-line rounded-xl">
            <div class="text-sm text-icon">Your store card will look like this:</div>
            <div class="mt-3 p-4 border border-line rounded-xl">
              <div class="text-xs text-icon">Store</div>
              <div class="font-semibold" id="prevName">Dev One Studio</div>
              <div class="text-sm text-icon" id="prevBio">We build professional templates and tools.</div>
              <div class="mt-2 text-xs"><span class="px-2 py-1 rounded bg-brand-100 text-brand-700" id="prevCat">Software & Code</span></div>
            </div>
          </div>
        </aside>
      </form>

      <!-- 3. Payments (placeholder) -->
      <form id="pane-3" class="pane hidden grid md:grid-cols-2 gap-6" onsubmit="event.preventDefault(); goto(4)">
        <div class="p-6 border border-line rounded-2xl shadow-soft">
          <h2 class="text-xl font-semibold mb-4">Payments</h2>
          <p class="text-sm text-icon mb-4">MVP placeholder. We will connect <strong>Stripe Connect (Standard/Express)</strong> here. For now, enter a mock IBAN or US account for testing (not saved to server).</p>
          <div class="grid gap-3">
            <label class="grid gap-1">
              <span class="text-sm">Payout method</span>
              <select name="payout" class="input">
                <option>Stripe (recommended)</option>
                <option>Bank transfer (manual)</option>
              </select>
            </label>
            <label class="grid gap-1">
              <span class="text-sm">Account (mock)</span>
              <input name="account" class="input" placeholder="US123456789 / TR00 0000 0000 0000" />
            </label>
          </div>
          <div class="mt-4 flex items-center justify-between">
            <button type="button" class="btn ghost" onclick="goto(2)">Back</button>
            <button class="btn">Continue</button>
          </div>
        </div>
        <aside class="p-6 border border-line rounded-2xl">
          <h3 class="font-medium mb-2">Fee estimator</h3>
          <div class="grid gap-2 text-sm">
            <label class="grid gap-1">
              <span>Price (USD)</span>
              <input id="price" class="input" type="number" step="0.01" value="49" />
            </label>
            <div class="p-3 border border-line rounded-xl">
              <div class="flex justify-between"><span>Stripe (~2.9% + 30¢)</span><span id="feeStripe">$1.72</span></div>
              <div class="flex justify-between"><span>RGZTEC fee (10%)</span><span id="feePlatform">$4.90</span></div>
              <div class="border-t my-2"></div>
              <div class="flex justify-between font-semibold"><span>Seller takes</span><span id="takeHome">$42.38</span></div>
            </div>
          </div>
        </aside>
      </form>

      <!-- 4. Products import -->
      <form id="pane-4" class="pane hidden grid md:grid-cols-2 gap-6" onsubmit="event.preventDefault(); goto(5)">
        <div class="p-6 border border-line rounded-2xl shadow-soft">
          <h2 class="text-xl font-semibold mb-4">Products</h2>
          <div class="grid gap-3">
            <div class="text-sm text-icon">Add at least one product (CSV or manual).</div>
            <label class="grid gap-1">
              <span class="text-sm">Quick add</span>
              <div class="grid grid-cols-2 gap-2">
                <input name="prodName" class="input" placeholder="Product name" />
                <input name="prodPrice" type="number" step="0.01" class="input" placeholder="Price" />
              </div>
            </label>
            <button type="button" class="btn" onclick="addProduct()">Add product</button>
            <label class="grid gap-1">
              <span class="text-sm">Import CSV</span>
              <input id="csv" type="file" accept=".csv" class="block text-sm" />
              <div class="text-xs text-icon">Headers: name, price, sku (optional)</div>
            </label>
          </div>
          <div class="mt-4 flex items-center justify-between">
            <button type="button" class="btn ghost" onclick="goto(3)">Back</button>
            <button class="btn">Continue</button>
          </div>
        </div>
        <aside class="p-6 border border-line rounded-2xl">
          <h3 class="font-medium mb-2">Your list</h3>
          <ul id="prodList" class="divide-y divide-line"></ul>
        </aside>
      </form>

      <!-- 5. Review & Publish -->
      <section id="pane-5" class="pane hidden grid md:grid-cols-2 gap-6">
        <div class="p-6 border border-line rounded-2xl shadow-soft">
          <h2 class="text-xl font-semibold mb-4">Review & publish</h2>
          <div class="grid gap-3 text-sm">
            <div><span class="font-medium">Seller:</span> <span id="revSeller"></span></div>
            <div><span class="font-medium">Email:</span> <span id="revEmail"></span></div>
            <div><span class="font-medium">Store:</span> <span id="revStore"></span> (<span id="revSlug"></span>)</div>
            <div><span class="font-medium">Category:</span> <span id="revCat"></span></div>
            <div><span class="font-medium">Products:</span> <span id="revCount"></span></div>
          </div>
          <div class="mt-4 flex items-center justify-between">
            <button type="button" class="btn ghost" onclick="goto(4)">Back</button>
            <button class="btn" onclick="publishStore()">Publish</button>
          </div>
        </div>
        <aside class="p-6 border border-line rounded-2xl">
          <h3 class="font-medium mb-2">What happens on publish?</h3>
          <ol class="list-decimal pl-5 text-sm text-icon space-y-1">
            <li>Create/merge seller in Firestore: <code>sellers/{sellerId}</code></li>
            <li>Create store: <code>stores/{slug}</code></li>
            <li>Batch write products: <code>stores/{slug}/products</code></li>
            <li>Redirect to <code>/store.html?slug={slug}</code></li>
          </ol>
          <p class="mt-2 text-xs">* This MVP uses <strong>localStorage</strong> only. Replace the stubs in <code>publishStore()</code> with real Firebase calls.</p>
        </aside>
      </section>
    </div>
  </main>

  <!-- Toast -->
  <div id="toast" class="fixed bottom-6 left-1/2 -translate-x-1/2 hidden px-4 py-2 bg-black text-white text-sm rounded-full shadow-soft">Saved</div>

  <script>
    // Helpers
    const $ = (sel, el=document) => el.querySelector(sel);
    const $$ = (sel, el=document) => Array.from(el.querySelectorAll(sel));
    const state = JSON.parse(localStorage.getItem('openStore')||'{}');

    // Resolve base path whether deployed at / or /rgztec/
    function base(){
      const parts = location.pathname.split('/').filter(Boolean);
      // If project lives under /<repo>/ (e.g., /rgztec/) return that as base
      if(parts.length && parts[0] !== 'store' && parts[0] !== 'stores' && parts[0] !== 'data'){
        return '/' + parts[0] + '/';
      }
      return '/';
    }

    function save(part){
      localStorage.setItem('openStore', JSON.stringify(state));
      showToast(part? part+" saved" : 'Saved');
      refreshReview();
    }
    function showToast(msg){
      const t = $('#toast'); t.textContent = msg; t.classList.remove('hidden');
      setTimeout(()=>t.classList.add('hidden'), 1200);
    }

    function goto(n){
      $$('.pane').forEach(p=>p.classList.add('hidden'));
      $('#pane-'+n).classList.remove('hidden');
      $$('#steps .step').forEach(li=>li.classList.remove('active'));
      $(`#steps [data-step="${n}"]`).classList.add('active');
      save();
    }

    function resetAll(){
      Object.keys(state).forEach(k=>delete state[k]);
      localStorage.removeItem('openStore');
      $$('input, textarea, select').forEach(el=>{ if(el.type!=='color' && el.type!=='file') el.value=''; });
      $('#prodList').innerHTML='';
      save('reset');
    }

    // Fee calculator
    function calcFees(){
      const p = parseFloat($('#price').value||0);
      const stripe = p*0.029 + 0.30;
      const platform = p*0.10;
      const take = Math.max(p - stripe - platform, 0);
      $('#feeStripe').textContent = `$${stripe.toFixed(2)}`;
      $('#feePlatform').textContent = `$${platform.toFixed(2)}`;
      $('#takeHome').textContent = `$${take.toFixed(2)}`;
    }

    // Products
    const products = state.products || [];
    function addProduct(){
      const name = $('[name="prodName"]').value.trim();
      const price = parseFloat($('[name="prodPrice"]').value||0);
      if(!name || !price){ showToast('Enter name & price'); return; }
      const sku = 'SKU-'+Math.random().toString(36).slice(2,8).toUpperCase();
      products.push({name, price, sku});
      state.products = products; save('product');
      renderProducts();
      $('[name="prodName"]').value='';
      $('[name="prodPrice"]').value='';
    }
    function renderProducts(){
      const ul = $('#prodList');
      ul.innerHTML = products.map((p,i)=>`
        <li class="py-3 flex items-center justify-between gap-4">
          <div>
            <div class="font-medium">${p.name}</div>
            <div class="text-xs text-icon">$${p.price.toFixed(2)} · ${p.sku}</div>
          </div>
          <button class="text-sm text-icon hover:text-text" onclick="delProduct(${i})">Remove</button>
        </li>`).join('');
    }
    function delProduct(i){ products.splice(i,1); state.products = products; save('product removed'); renderProducts(); }

    // CSV import
    $('#csv')?.addEventListener('change', e=>{
      const file = e.target.files[0]; if(!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        const rows = reader.result.split(/\r?\n/).filter(Boolean);
        const [h, ...data] = rows;
        const idx = (name)=> h.split(',').map(s=>s.trim()).indexOf(name);
        const iName = idx('name'), iPrice = idx('price'), iSku = idx('sku');
        data.forEach(line=>{
          const cols = line.split(',');
          const name = cols[iName]?.trim();
          const price = parseFloat(cols[iPrice]||0);
          if(name && price){
            const sku = cols[iSku]?.trim() || 'SKU-'+Math.random().toString(36).slice(2,8).toUpperCase();
            products.push({name, price, sku});
          }
        });
        state.products = products; save('CSV imported'); renderProducts();
      };
      reader.readAsText(file);
    });

    // Bind inputs to state
    function bind(name, effect){
      const el = document.querySelector(`[name="${name}"]`);
      if(!el) return;
      if(state[name]!==undefined && el.type!=='file'){ el.value = state[name]; }
      el.addEventListener('input', ()=>{ state[name] = el.value; save(name); effect && effect(el.value); });
    }

    function refreshPreview(){
      $('#prevName').textContent = state.storeName || 'Dev One Studio';
      $('#prevBio').textContent = state.storeBio || 'We build professional templates and tools.';
      $('#prevCat').textContent = state.storeCategory || 'Software & Code';
      document.documentElement.style.setProperty('--brand', state.brandColor||'#6366f1');
    }

    function refreshReview(){
      $('#revSeller').textContent = state.sellerName||'';
      $('#revEmail').textContent = state.sellerEmail||'';
      $('#revStore').textContent = state.storeName||'';
      $('#revSlug').textContent = state.storeSlug||'';
      $('#revCat').textContent = state.storeCategory||'';
      $('#revCount').textContent = (state.products||[]).length;
    }

    async function publishStore(){
      // Guard
      if(!state.sellerName || !state.sellerEmail || !state.storeName || !state.storeSlug){
        showToast('Complete required fields'); return;
      }
      // TODO: Replace this with Firebase writes
      // 1) sellers/{sellerId}
      // 2) stores/{slug}
      // 3) stores/{slug}/products
      localStorage.setItem('store:'+state.storeSlug, JSON.stringify(state));
      showToast('Published');
      // Redirect to your existing store page route
      location.href = base() + 'store.html?slug=' + encodeURIComponent(state.storeSlug);
    }

    // Init
    document.addEventListener('DOMContentLoaded', ()=>{
      // set header links based on base path
      const bh = base();
      const home = $('#linkHome'); const stores = $('#linkStores'); const open = $('#linkOpenStore');
      if(home) home.href = bh;
      if(stores) stores.href = bh + 'stores/';
      if(open) open.href = bh + 'open-store.html';

      // bind step 1
      bind('sellerName'); bind('sellerEmail'); bind('sellerPhone'); bind('sellerCountry');
      // step 2
      bind('storeName', refreshPreview); bind('storeSlug'); bind('storeCategory', refreshPreview); bind('storeBio', refreshPreview); bind('brandColor', refreshPreview);
      refreshPreview(); renderProducts(); calcFees(); refreshReview();
      $('#price').addEventListener('input', calcFees);
      goto(1);
    });
  </script>

  <style>
    .input{ @apply w-full h-11 px-3 border border-line rounded-xl outline-none focus:ring-2 focus:ring-brand-300; }
    .btn{ @apply inline-flex items-center justify-center h-10 px-4 rounded-xl bg-brand-600 text-white hover:bg-brand-700 transition; }
    .btn.ghost{ @apply bg-transparent text-text border border-line hover:bg-gray-50; }
    #steps .active > div{ @apply border-brand-300 bg-brand-50; }
  </style>
</body>
</html>
