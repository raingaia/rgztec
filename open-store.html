<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Open Store — RGZTEC</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>tailwind.config={theme:{extend:{colors:{line:'#e5e7eb'},boxShadow:{soft:'0 10px 30px rgba(0,0,0,.08)'}}}};</script>
  <style>
    :root{--wrap:1200px}
    .wrap{max-width:var(--wrap);margin-inline:auto}
    /* tiny typeahead styles (drawer-like list) */
    .typeahead{position:relative}
    .typeahead ul{
      position:absolute;left:0;right:0;z-index:40;margin-top:.25rem;
      padding:.5rem;border:1px solid #e5e7eb;border-radius:.75rem;background:#fff;
      box-shadow:0 10px 30px rgba(0,0,0,.08);max-height:220px;overflow:auto
    }
    .typeahead li{padding:.5rem;border-radius:.5rem;cursor:pointer}
    .typeahead li:hover{background:#f3f4f6}
  </style>
</head>
<body class="bg-white text-gray-900">

<header class="sticky top-0 z-50 bg-white/80 backdrop-blur border-b border-gray-200">
  <div class="wrap px-4 py-3 flex items-center gap-4">
    <a href="index.html" class="font-extrabold tracking-tight text-lg text-orange-600 hover:text-orange-700">RGZTEC</a>
    <span class="hidden md:inline-flex items-center text-xs text-gray-500 border-l border-gray-200 pl-3">US-based company • Global payments</span>
    <nav class="ml-auto flex items-center gap-3 text-sm">
      <a href="stores/" class="text-gray-600 hover:text-black">Stores</a>
      <a href="seller.html" class="text-gray-600 hover:text-black">Open Store</a>
    </nav>
  </div>
</header>

<main class="wrap px-4 py-10">
  <h1 class="text-4xl font-extrabold tracking-tight">Open Store</h1>
  <p class="mt-2 text-gray-500 max-w-2xl">Create your seller profile, set up your shop, import products and publish — all in a few minutes. This MVP is HTML + vanilla JS and ready to wire into Firebase when you are.</p>

  <!-- Steps -->
  <ul class="mt-6 grid grid-cols-5 gap-3">
    <li class="px-5 h-12 inline-flex items-center gap-2 rounded-2xl bg-orange-50 text-orange-700 ring-1 ring-orange-200 shadow-sm"><span class="text-xs">Step 1</span><span class="font-semibold">Seller</span></li>
    <li class="px-5 h-12 inline-flex items-center gap-2 rounded-2xl bg-white ring-1 ring-gray-200 shadow-sm hover:shadow-md"><span class="text-xs text-gray-500">Step 2</span><span class="font-semibold">Store</span></li>
    <li class="px-5 h-12 inline-flex items-center gap-2 rounded-2xl bg-white ring-1 ring-gray-200 shadow-sm hover:shadow-md"><span class="text-xs text-gray-500">Step 3</span><span class="font-semibold">Payments</span></li>
    <li class="px-5 h-12 inline-flex items-center gap-2 rounded-2xl bg-white ring-1 ring-gray-200 shadow-sm hover:shadow-md"><span class="text-xs text-gray-500">Step 4</span><span class="font-semibold">Products</span></li>
    <li class="px-5 h-12 inline-flex items-center gap-2 rounded-2xl bg-white ring-1 ring-gray-200 shadow-sm hover:shadow-md"><span class="text-xs text-gray-500">Step 5</span><span class="font-semibold">Review</span></li>
  </ul>

  <div class="mt-6 grid md:grid-cols-2 gap-6">
    <!-- Seller profile -->
    <div class="p-6 md:p-8 border border-line rounded-3xl shadow-[0_10px_30px_rgba(0,0,0,.08)] bg-white">
      <h3 class="text-lg font-semibold mb-4">Seller profile</h3>
      <form id="sellerForm" class="space-y-4">
        <label class="block text-sm">Full name / Company
          <input id="sellerName" type="text" required placeholder="Acme Inc."
                 class="mt-1 w-full h-11 px-3 border border-gray-200 rounded-xl outline-none focus:ring-2 focus:ring-indigo-300">
          <p id="errName" class="mt-1 text-xs text-red-600 hidden">Please enter at least 2 characters.</p>
        </label>
        <label class="block text-sm">Email
          <input id="sellerEmail" type="email" required placeholder="founder@acme.com"
                 class="mt-1 w-full h-11 px-3 border border-gray-200 rounded-xl outline-none focus:ring-2 focus:ring-indigo-300">
          <p id="errEmail" class="mt-1 text-xs text-red-600 hidden">Please enter a valid email.</p>
        </label>
        <label class="block text-sm">Phone (optional)
          <input id="sellerPhone" type="tel" inputmode="tel" placeholder="+1 555 0100 000"
                 class="mt-1 w-full h-11 px-3 border border-gray-200 rounded-xl outline-none focus:ring-2 focus:ring-indigo-300">
          <p class="mt-1 text-xs text-gray-500">Use E.164 format if possible (e.g., +15550100000). We don’t store this field locally.</p>
        </label>

        <!-- Country (searchable) -->
        <label class="block text-sm">Country
          <input id="sellerCountry" list="countryList" placeholder="Search country..."
                 class="mt-1 w-full h-11 px-3 border border-gray-200 rounded-xl outline-none focus:ring-2 focus:ring-indigo-300" required>
          <datalist id="countryList"></datalist>
        </label>

        <!-- City (typeahead) -->
        <label class="block text-sm">City
          <div id="cityBox" class="typeahead">
            <input id="sellerCity" placeholder="Type to search city (e.g. stanbu, pari, milan)" autocomplete="off" autocapitalize="off" spellcheck="false"
                   class="mt-1 w-full h-11 px-3 border border-gray-200 rounded-xl outline-none focus:ring-2 focus:ring-indigo-300">
            <div id="citySuggest"></div>
          </div>
          <input type="hidden" id="sellerLat">
          <input type="hidden" id="sellerLon">
        </label>

        <div class="flex items-center justify-end gap-3 pt-2">
          <button id="btnReset" type="button" class="px-3 h-10 rounded-xl border border-gray-200 hover:bg-gray-50">Reset</button>
          <button id="btnNext1" type="button" disabled class="px-5 h-10 rounded-xl bg-orange-600 text-white disabled:opacity-50 disabled:cursor-not-allowed hover:bg-orange-700">Continue</button>
        </div>
      </form>
    </div>

    <!-- Why we need this -->
    <div class="p-6 md:p-8 border border-line rounded-3xl bg-white shadow-[0_10px_30px_rgba(0,0,0,.08)]">
      <h3 class="text-lg font-semibold mb-2">Why we need this</h3>
      <p class="text-sm text-gray-600">This info builds your seller record in Firestore. KYC/KYB comes later when you connect payments.</p>
      <ul class="mt-3 text-sm text-gray-600 space-y-2">
        <li class="flex items-center gap-2"><svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>Name & contact for invoices</li>
        <li class="flex items-center gap-2"><svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>Country for tax rules</li>
      </ul>
    </div>
  </div>

  <!-- Payments (Step 3) -->
  <div class="mt-6 grid md:grid-cols-2 gap-6">
    <div id="paymentsPanel" class="p-6 md:p-8 border border-line rounded-3xl bg-white shadow-[0_10px_30px_rgba(0,0,0,.08)]">
      <h3 class="text-lg font-semibold mb-4">Payments</h3>
      <fieldset class="space-y-3">
        <legend class="text-sm font-semibold mb-2">Payout method</legend>

        <label class="flex items-start gap-3 p-3 border border-gray-200 rounded-2xl hover:bg-gray-50">
          <input type="radio" name="payoutMethod" value="stripe" checked>
          <div>
            <div class="font-semibold">Stripe Connect (recommended)</div>
            <div class="text-sm text-gray-500">Automatic KYC/KYB. Payouts to local bank accounts in supported countries.</div>
          </div>
        </label>

        <label class="flex items-start gap-3 p-3 border border-gray-200 rounded-2xl hover:bg-gray-50">
          <input type="radio" name="payoutMethod" value="wise">
          <div>
            <div class="font-semibold">Wise Business (beta)</div>
            <div class="text-sm text-gray-500">Multi-currency payouts for unsupported countries. IBAN/SWIFT required.</div>
          </div>
        </label>

        <label class="flex items-start gap-3 p-3 border border-gray-200 rounded-2xl hover:bg-gray-50">
          <input type="radio" name="payoutMethod" value="payoneer">
          <div>
            <div class="font-semibold">Payoneer (beta)</div>
            <div class="text-sm text-gray-500">Global payouts alternative to Wise.</div>
          </div>
        </label>

        <label class="flex items-start gap-3 p-3 border border-gray-200 rounded-2xl hover:bg-gray-50">
          <input type="radio" name="payoutMethod" value="hold">
          <div>
            <div class="font-semibold">Hold funds until connected</div>
            <div class="text-sm text-gray-500">We’ll keep your balance safe until you connect a payout method.</div>
          </div>
        </label>
      </fieldset>

      <div class="flex items-center justify-end gap-3 pt-4">
        <button id="btnNext3" type="button" class="px-5 h-10 rounded-xl bg-orange-600 text-white hover:bg-orange-700">Continue</button>
      </div>
    </div>

    <div class="p-6 md:p-8 border border-line rounded-3xl bg-white shadow-[0_10px_30px_rgba(0,0,0,.08)]">
      <h3 class="text-lg font-semibold mb-2">Notes</h3>
      <ul class="text-sm text-gray-600 space-y-2">
        <li class="flex items-center gap-2"><svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>Buyers can pay globally (Stripe Checkout/Payment Element).</li>
        <li class="flex items-center gap-2"><svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>For unsupported countries, use Wise/Payoneer or keep funds on hold.</li>
      </ul>
    </div>
  </div>
</main>

<script>
const $=(s)=>document.querySelector(s);
function validEmail(v){return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v)}
function trim(v){return (v||'').trim()}

// step pills highlight
function setStep(active){ // 1..5
  const pills = document.querySelectorAll('ul.grid.grid-cols-5 > li');
  pills.forEach((li, idx) => {
    const on = (idx+1) === active;
    li.classList.toggle('bg-orange-50', on);
    li.classList.toggle('text-orange-700', on);
    li.classList.toggle('ring-orange-200', on);
  });
}

// STEP 1
function refreshStep1(){
  const okName=trim($('#sellerName').value).length>=2;
  const okEmail=validEmail(trim($('#sellerEmail').value));
  const okCountry=trim($('#sellerCountry').value).length>0;
  const okCity=trim($('#sellerCity').value).length>=2;

  $('#errName').classList.toggle('hidden',okName);
  $('#errEmail').classList.toggle('hidden',okEmail);
  const can=okName&&okEmail&&okCountry&&okCity;
  const b=$('#btnNext1');
  b.disabled=!can; b.classList.toggle('opacity-50',!can); b.classList.toggle('cursor-not-allowed',!can);
}
function saveStep1(){
  // privacy-first: phone is intentionally NOT persisted
  window.state=window.state||{};
  state.sellerName=trim($('#sellerName').value);
  state.sellerEmail=trim($('#sellerEmail').value);
  state.sellerCountry=trim($('#sellerCountry').value);
  state.sellerCity=trim($('#sellerCity').value);
  state.sellerLat=trim($('#sellerLat').value);
  state.sellerLon=trim($('#sellerLon').value);
  localStorage.setItem('openStore',JSON.stringify(state));
}

// STEP 3
function refreshPayments(){
  window.state=window.state||{}; state.payout=state.payout||{};
  const m=document.querySelector('input[name="payoutMethod"]:checked')?.value||'stripe';
  state.payout.method=m; localStorage.setItem('openStore',JSON.stringify(state));
  const btn=$('#btnNext3'); if(btn){ btn.disabled=false; btn.classList.remove('opacity-50','cursor-not-allowed'); }
}

document.addEventListener('DOMContentLoaded',()=>{
  // optional clear shortcut: ?clear=1 wipes local state
  const params = new URLSearchParams(location.search);
  if (params.get('clear') === '1') { localStorage.removeItem('openStore'); }

  // restore minimal state (no phone)
  try{
    const saved=JSON.parse(localStorage.getItem('openStore')||'{}');
    if(saved.sellerName)$('#sellerName').value=saved.sellerName;
    if(saved.sellerEmail)$('#sellerEmail').value=saved.sellerEmail;
    if(saved.sellerCountry)$('#sellerCountry').value=saved.sellerCountry;
    if(saved.sellerCity)$('#sellerCity').value=saved.sellerCity;
    if(saved.sellerLat)$('#sellerLat').value=saved.sellerLat;
    if(saved.sellerLon)$('#sellerLon').value=saved.sellerLon;
    window.state=saved;
  }catch(e){window.state={}}

  // always blank out phone for privacy
  const phoneEl = document.getElementById('sellerPhone');
  if (phoneEl) phoneEl.value = '';

  ['sellerName','sellerEmail','sellerCountry','sellerCity'].forEach(id=>{
    const el=document.getElementById(id);
    el&&el.addEventListener('input',refreshStep1);
    el&&el.addEventListener('blur',refreshStep1);
  });

  $('#btnReset')?.addEventListener('click',()=>{
    localStorage.removeItem('openStore');
    ['sellerName','sellerEmail','sellerCountry','sellerCity'].forEach(id=>{const el=document.getElementById(id); if(el) el.value='';});
    if (phoneEl) phoneEl.value = ''; // keep empty
    $('#sellerLat').value=''; $('#sellerLon').value='';
    refreshStep1();
  });

  // UPDATED: go to Payments smoothly and highlight pill
  $('#btnNext1')?.addEventListener('click',()=>{
    if($('#btnNext1').disabled) return;
    saveStep1();
    setStep(3);
    document.getElementById('paymentsPanel')?.scrollIntoView({behavior:'smooth',block:'start'});
  });

  document.querySelectorAll('input[name="payoutMethod"]').forEach(r=>r.addEventListener('change',refreshPayments));

  refreshStep1();
  refreshPayments();
});
</script>

<!-- Country & City logic (search + typeahead; API key not required) -->
<script>
// ---- Countries (short list; istersen ISO-3166 full listeyi ekleyebilirim)
const COUNTRIES = ["United States","United Kingdom","Germany","Canada","Turkey","France","Italy","Spain","Netherlands","Sweden","Norway","Denmark","Finland","Poland","Portugal","Greece","Ireland","Switzerland","Austria","Belgium","Australia","New Zealand","India","Japan","China","South Korea","Singapore","United Arab Emirates","Saudi Arabia","Brazil","Argentina","Mexico","South Africa","Egypt","Israel","Thailand","Malaysia","Indonesia","Philippines","Vietnam","Czechia","Romania","Bulgaria","Hungary","Slovakia","Slovenia","Croatia","Serbia","Chile","Colombia","Peru","Other"];
const countryListEl = document.getElementById('countryList');
countryListEl.innerHTML = COUNTRIES.map(c=>`<option value="${c}"></option>`).join('');

// ---- City search (Open-Meteo Geocoding)
const countryInput = document.getElementById('sellerCountry');
const cityInput = document.getElementById('sellerCity');
const suggest = document.getElementById('citySuggest');
const latEl = document.getElementById('sellerLat');
const lonEl = document.getElementById('sellerLon');

const norm = s => (s||'').toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu,''); // stanbu -> Istanbul eşleşsin
function debounce(fn,ms){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a),ms);} }

function renderSuggestions(items){
  if(!items?.length){ suggest.innerHTML=''; return; }
  suggest.innerHTML = `<ul>` + items.map(it=>{
    const line = [it.name, it.admin1, it.country].filter(Boolean).join(', ');
    return `<li data-lat="${it.latitude}" data-lon="${it.longitude}" data-name="${it.name}">${line}</li>`;
  }).join('') + `</ul>`;
  suggest.querySelectorAll('li').forEach(li=>{
    li.addEventListener('click',()=>{
      cityInput.value = li.dataset.name;
      latEl.value = li.dataset.lat;
      lonEl.value = li.dataset.lon;
      suggest.innerHTML='';
      saveStep1(); // seçimi hemen persist edelim
      refreshStep1(); // Continue butonunu güncelle
    });
  });
}

const searchCities = debounce(async ()=>{
  const q = cityInput.value.trim();
  if(q.length < 2){ suggest.innerHTML=''; return; }

  // Ülkeye göre daraltma: isim yazıldığı gibi (United States / France / Italy ...)
  const ccName = countryInput.value.trim();
  const url = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(q)}&count=20&language=en&format=json`;
  try{
    const res = await fetch(url);
    const data = await res.json();
    let results = Array.isArray(data.results) ? data.results : [];

    // 1) yalnızca şehir merkezleri (PPL*, PPLA*, PPLC)
    results = results.filter(r => {
      const fc = String(r.feature_code||'').toUpperCase();
      return fc.startsWith('PPL') || fc === 'PPLC';
    });

    // 2) ülke yazılmışsa öncelik ver (gevşek eşleşme; France, Italy, Germany vs.)
    if(ccName && ccName.toLowerCase() !== 'other'){
      const cn = norm(ccName);
      results = results.filter(r => norm(r.country).includes(cn));
    }

    // 3) sorguyla gevşek eşleşme (stanbu -> Istanbul, pari -> Paris, milan -> Milano)
    const qn = norm(q);
    results = results.filter(r => norm(r.name).includes(qn) || norm(r.admin1||'').includes(qn));

    // 4) anlamlı sıralama: nüfusa göre (büyük->küçük), sonra isim
    results.sort((a,b)=>(b.population||0)-(a.population||0) || String(a.name).localeCompare(String(b.name)));

    renderSuggestions(results.slice(0,10));
  }catch(e){
    console.warn('City search failed', e);
    renderSuggestions([]);
  }
}, 250);

cityInput.addEventListener('input', searchCities);
// tıklamayı kaçırmamak için blur'da biraz gecikmeli kapat
cityInput.addEventListener('blur', ()=> setTimeout(()=> suggest.innerHTML='', 150));
</script>

</body>
</html>

