<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>RGZTEC • Open Store</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Plus+Jakarta+Sans:wght@600;700;800&display=swap" rel="stylesheet">

<link rel="stylesheet" href="assets/css/theme-tokens.css?v=1">
<link rel="stylesheet" href="assets/css/store-core.css">

<style>
/* === MEVCUT STİLLERİN (Değişmedi) === */
:root { --brand: #f97316; --brand-h: #ea580c; --ink: #0f172a; --sub: #64748b; --border: #e2e8f0; --bg-body: #f8fafc; --header-h: 74px; }
body { font-family: 'Inter', sans-serif; background: var(--bg-body); color: var(--ink); margin: 0; }
.container { max-width: 1440px; margin: 0 auto; padding: 0 24px; }
.app-header { background: rgba(255,255,255,0.96); backdrop-filter: blur(12px); border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 1000; height: var(--header-h); display: flex; align-items: center; }
.header-inner { display: flex; justify-content: space-between; align-items: center; width: 100%; gap: 24px; }
.logo { font-family: 'Plus Jakarta Sans', sans-serif; font-weight: 800; font-size: 24px; color: var(--brand); text-decoration: none; }

.nav-right { display: flex; align-items: center; gap: 20px; }
.nav-link { font-size: 14px; font-weight: 600; color: var(--sub); text-decoration: none; transition:0.2s; }
.nav-link:hover { color: var(--brand); }
.btn-open-store { background: var(--ink); color: #fff; padding: 10px 22px; border-radius: 99px; font-size: 14px; font-weight: 700; text-decoration: none; transition:0.2s; }
.btn-open-store:hover { background: var(--brand); }

/* Mega Menü */
.mega-menu-overlay { position: fixed; top: var(--header-h); left: 0; width: 100%; height: calc(100vh - var(--header-h)); background: rgba(15,23,42,0.3); visibility: hidden; opacity: 0; transition: 0.3s; z-index: 900; }
.mega-menu-overlay.open { visibility: visible; opacity: 1; }
.mega-menu-container { position: absolute; top: 12px; left: 24px; width: 900px; height: 500px; background: #fff; display: flex; border-radius: 16px; overflow: hidden; transform: translateY(-10px); transition: 0.3s; box-shadow: 0 20px 60px rgba(0,0,0,0.15); border:1px solid var(--border); }
.mega-menu-overlay.open .mega-menu-container { transform: translateY(0); }
.menu-sidebar { width: 280px; background: #f8fafc; border-right: 1px solid var(--border); padding: 16px; overflow-y: auto; }
.menu-store-item { padding: 10px 16px; font-size: 14px; font-weight: 600; cursor: pointer; border-radius: 8px; margin-bottom: 4px; display: flex; justify-content: space-between; align-items:center; transition:0.2s; }
.menu-store-item:hover, .menu-store-item.active { background: #fff; color: var(--brand); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
.menu-content { flex: 1; padding: 32px; overflow-y: auto; }

/* Form Area */
.open-store-wrap { max-width: 1100px; margin: 0 auto; padding: 40px 24px; }
.card { background: #fff; border: 1px solid var(--border); border-radius: 16px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.03); }
.pad { padding: 24px; }
input, textarea, select { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 10px; margin-bottom: 16px; display: block; box-sizing: border-box; font-family: inherit; font-size:14px; background:#fff; }
input:focus, textarea:focus, select:focus { border-color: var(--brand); outline: none; box-shadow: 0 0 0 3px rgba(249,115,22,0.1); }
label { font-weight: 700; font-size: 14px; margin-bottom: 8px; display: block; color:var(--ink); }
.btn { background: var(--brand); color: #fff; padding: 12px 24px; border-radius: 10px; border: none; font-weight: 700; cursor: pointer; transition:0.2s; }
.btn:hover { background: var(--brand-h); transform:translateY(-2px); box-shadow: 0 8px 20px rgba(249,115,22,0.25); }
.drop { border: 2px dashed var(--border); padding: 24px; text-align: center; border-radius: 14px; cursor: pointer; background: #f8fafc; transition:0.2s; }
.drop:hover { border-color:var(--brand); background:#fff7ed; }
</style>
</head>
<body>

<header class="app-header">
  <div class="container header-inner">
    <div style="display:flex; align-items:center; gap:24px;">
      <a href="./" class="logo">RGZTEC</a>
      <button class="nav-link" id="btnCategories" style="background:none; border:none; cursor:pointer; display:flex; align-items:center; gap:6px; font-family:inherit;">
        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"></path></svg>
        Categories
      </button>
    </div>
    
    <div class="nav-right">
      <a href="editor/" class="nav-link">Dashboard</a>
      <a href="login.html" class="nav-link">Sign In</a>
      <a href="open-store.html" class="btn-open-store">Open Store</a>
    </div>
  </div>
</header>

<div class="mega-menu-overlay" id="megaMenu">
  <div class="mega-menu-container">
    <div class="menu-sidebar" id="menuSidebar">
        <p style="padding:20px; color:#999; font-size:14px;">Loading...</p>
    </div>
    <div class="menu-content" id="menuContent">
      <div class="menu-header">
          <h3 id="menuTitle" style="margin:0 0 8px; font-size:24px;">Select a Category</h3>
          <p id="menuDesc" style="color:var(--sub); margin:0 0 24px;">Browse items</p>
      </div>
      <div id="menuGrid" style="display:grid; grid-template-columns: 1fr 1fr; gap:16px;"></div>
    </div>
  </div>
</div>

<div class="open-store-wrap">
  <h1 style="font-size:32px; font-weight:800; margin-bottom:10px;">Open your store</h1>
  <p style="color:var(--sub); margin-bottom:32px;">Create your first product and upload images. (Demo Mode)</p>

  <div style="display:grid; grid-template-columns: 1.2fr 0.8fr; gap:32px;">
    <div class="card">
      <div class="pad">
        <form id="f">
          <label>Product Title</label>
          <input name="title" placeholder="e.g. Sticky Header UI Kit" required>

          <label>Description</label>
          <textarea name="desc" placeholder="Tell buyers what they get..." style="min-height:100px; resize:vertical;"></textarea>

          <div style="display:grid; grid-template-columns: 1fr 1fr; gap:16px;">
            <div>
              <label>Price (USD)</label>
              <input name="price" type="number" value="29" min="0">
            </div>
            <div>
              <label>Category</label>
              <select id="cat" name="cat" required>
                <option value="" disabled selected>Loading categories...</option>
              </select>
            </div>
          </div>

          <label>Images</label>
          <div id="drop" class="drop">
            <strong>Drag & drop images</strong><br>
            <span style="font-size:12px; color:var(--sub);">PNG, JPG (max 5MB)</span>
            <input type="file" id="file" hidden multiple accept="image/*">
          </div>
          <div id="gallery" style="display:flex; gap:10px; flex-wrap:wrap; margin-top:16px;"></div>

          <div id="statusMsg" style="margin-top:16px; padding:10px; border-radius:8px; font-size:14px; display:none;"></div>

          <button type="submit" class="btn" style="margin-top:20px; width:100%;">Save Product</button>
        </form>
      </div>
    </div>

    <div class="card" style="height:fit-content;">
      <div class="pad">
        <h3 style="margin-top:0;">How it works?</h3>
        <p style="font-size:14px; color:var(--sub); line-height:1.6;">
          Files are saved to your browser's LocalStorage for demo purposes.
          Requires a running server/API for production.
        </p>
      </div>
    </div>
  </div>
</div>

<script>
/* --- DÜZELTİLMİŞ KOD BURADA --- */
let RAW_DATA = {}; 

document.addEventListener('DOMContentLoaded', async () => {
    const catSelect = document.getElementById('cat');
    const menuSidebar = document.getElementById('menuSidebar');

    try {
        // 1. JSON Verisini Çek
        // EĞER JSON DOSYASI ALT KLASÖRDEYSE YOLUNU GÜNCELLE (Örn: assets/store.data.json)
        const response = await fetch('store.data.json'); 
        
        if (!response.ok) throw new Error("JSON dosyası bulunamadı.");
        
        RAW_DATA = await response.json();
        
        // 2. Form Dropdown'ı Temizle
        catSelect.innerHTML = '<option value="" disabled selected>Select a category...</option>';
        
        // 3. YENİ PARSING MANTIĞI (Önemli Kısım)
        // Senin yeni verin bir Obje (Array değil). Örn: { "game-makers": {...}, "ai": {...} }
        Object.keys(RAW_DATA).forEach(storeKey => {
            const store = RAW_DATA[storeKey];
            
            // Ana başlık grubu oluştur (Örn: GAME MAKERS)
            const group = document.createElement('optgroup');
            group.label = store.title;
            
            // Alt bölümleri (sections) seçenek olarak ekle
            if (store.sections && Array.isArray(store.sections)) {
                store.sections.forEach(sec => {
                    const opt = document.createElement('option');
                    // Value'ya hem ana key'i hem slug'ı koyuyoruz ki backend'de ayrıştırabilesin
                    opt.value = `${storeKey}|${sec.slug}`; 
                    opt.textContent = sec.name; // Örn: Prototypes, UI & HUD
                    group.appendChild(opt);
                });
            }
            catSelect.appendChild(group);
        });

        // 4. Mega Menü Sidebar'ını Doldur
        let sidebarHTML = '';
        Object.keys(RAW_DATA).forEach(storeKey => {
            const store = RAW_DATA[storeKey];
            sidebarHTML += `
            <div class="menu-store-item" onclick="selectMenuCategory('${storeKey}')" data-key="${storeKey}">
                <span>${store.title}</span>
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
            </div>`;
        });
        menuSidebar.innerHTML = sidebarHTML;

        // İlk menüyü seçili yap
        const firstKey = Object.keys(RAW_DATA)[0];
        if(firstKey) selectMenuCategory(firstKey);

    } catch (err) {
        console.error("Hata Detayı:", err);
        catSelect.innerHTML = '<option disabled>Error loading data</option>';
        menuSidebar.innerHTML = '<p style="color:red; padding:15px;">Data could not be loaded.</p>';
    }
});

/* --- MEGA MENÜ MANTIĞI --- */
const megaMenu = document.getElementById('megaMenu');
const btnCategories = document.getElementById('btnCategories');
const menuTitle = document.getElementById('menuTitle');
const menuDesc = document.getElementById('menuDesc');
const menuGrid = document.getElementById('menuGrid');

window.selectMenuCategory = function(key) {
    document.querySelectorAll('.menu-store-item').forEach(el => el.classList.remove('active'));
    const activeItem = document.querySelector(`.menu-store-item[data-key="${key}"]`);
    if(activeItem) activeItem.classList.add('active');

    const store = RAW_DATA[key];
    if(store) {
        menuTitle.textContent = store.title;
        menuDesc.textContent = store.tagline || "";
        
        let gridHTML = '';
        if (store.sections) {
            store.sections.forEach(sec => {
                gridHTML += `
                <a href="#" style="display:block; padding:12px; border:1px solid var(--border); border-radius:10px; text-decoration:none; color:inherit; transition:0.2s;" onmouseover="this.style.borderColor='var(--brand)'; this.style.background='#fff7ed'" onmouseout="this.style.borderColor='var(--border)'; this.style.background='transparent'">
                    <div style="font-weight:700; font-size:14px; color:var(--ink);">${sec.name}</div>
                    <div style="font-size:12px; color:var(--sub); margin-top:4px;">${sec.tagline || ""}</div>
                </a>`;
            });
        }
        menuGrid.innerHTML = gridHTML;
    }
}

// Menü Aç/Kapa
btnCategories.addEventListener('click', (e) => {
    e.stopPropagation();
    megaMenu.classList.toggle('open');
});
document.addEventListener('click', (e) => {
    if(!megaMenu.contains(e.target) && !btnCategories.contains(e.target)) {
        megaMenu.classList.remove('open');
    }
});
</script>
</body>
</html>
