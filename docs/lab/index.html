<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>RGZTEC • Dashboard / Editor</title>

  <!-- Base (opsiyonel) -->
  <meta name="rgz-base" content="">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Plus+Jakarta+Sans:wght@600;700;800&display=swap" rel="stylesheet">

  <!-- ✅ Home ile aynı dil (lab/ altında olduğun için ../) -->
  <link rel="stylesheet" href="../assets/css/theme-tokens.css?v=1">
  <link rel="stylesheet" href="../assets/css/store-core.css?v=1">
  <link rel="stylesheet" href="../assets/css/home.css?v=1">

  <style>
    /* =========================================================
       LAB / EDITOR – Premium UI (Home uyumlu)
    ========================================================= */

    :root{
      --lab-bg: #ffffff;
      --lab-muted: #6b7280;
      --lab-border: rgba(0,0,0,.08);
      --lab-shadow: 0 18px 40px rgba(0,0,0,.10);
      --lab-soft: #f6f7f9;
      --lab-accent: #ff6b00;
      --lab-card: #ffffff;
      --lab-codebg: #0b1020;
      --lab-codetext: #e7ecff;
    }

    body[data-theme="light"]{
      --lab-bg:#ffffff;
      --lab-soft:#f6f7f9;
      --lab-card:#ffffff;
      --lab-codebg:#0b1020;
      --lab-codetext:#e7ecff;
    }

    body[data-theme="corporate"]{
      /* RGZTEC corporate: temiz + premium */
      --lab-bg:#ffffff;
      --lab-soft:#f7f7fb;
      --lab-card:#ffffff;
      --lab-codebg:#0b1020;
      --lab-codetext:#e7ecff;
    }

    body[data-theme="dark"]{
      --lab-bg:#0b1220;
      --lab-soft:#0f1a30;
      --lab-card:#0f1a30;
      --lab-border: rgba(255,255,255,.10);
      --lab-shadow: 0 18px 40px rgba(0,0,0,.45);
      --lab-muted: rgba(255,255,255,.65);
      --lab-codebg:#050815;
      --lab-codetext:#e7ecff;
    }

    body{
      background: var(--lab-bg) !important;
    }

    .lab-wrap{
      margin-top: 28px;
      margin-bottom: 38px;
    }

    .lab-head{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:16px;
      margin-bottom: 16px;
    }

    .lab-title{
      font-size: 26px;
      font-weight: 900;
      letter-spacing: -0.02em;
      color: #111827;
    }
    body[data-theme="dark"] .lab-title{ color:#ffffff; }

    .lab-sub{
      margin-top: 6px;
      color: var(--lab-muted);
      font-weight: 600;
      font-size: 13px;
      line-height: 1.55;
      max-width: 720px;
    }

    .lab-controls{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    .lab-pill{
      display:flex;
      align-items:center;
      gap:8px;
      padding: 10px 12px;
      border:1px solid var(--lab-border);
      border-radius: 999px;
      background: var(--lab-card);
      box-shadow: 0 10px 24px rgba(0,0,0,.06);
    }

    .lab-pill label{
      font-size: 12px;
      font-weight: 900;
      color:#111827;
      letter-spacing: .08em;
      text-transform: uppercase;
      opacity: .75;
    }
    body[data-theme="dark"] .lab-pill label{ color:#fff; }

    .lab-select{
      border:none;
      outline:none;
      background: transparent;
      font-weight: 800;
      color: inherit;
      cursor:pointer;
    }

    .lab-btn{
      border:1px solid var(--lab-border);
      background: var(--lab-card);
      color: #111827;
      font-weight: 900;
      border-radius: 999px;
      padding: 10px 14px;
      cursor:pointer;
      transition: .15s ease;
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    body[data-theme="dark"] .lab-btn{ color:#fff; }

    .lab-btn:hover{
      transform: translateY(-1px);
      box-shadow: 0 14px 26px rgba(0,0,0,.10);
      border-color: rgba(255,107,0,.25);
    }
    .lab-btn.primary{
      background: linear-gradient(180deg, #ff7a1a 0%, #ff6b00 100%);
      border-color: rgba(255,107,0,.45);
      color:#fff;
      box-shadow: 0 18px 34px rgba(255,107,0,.22);
    }
    .lab-btn.primary:hover{
      box-shadow: 0 22px 44px rgba(255,107,0,.28);
    }

    /* Grid */
    .lab-grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 18px;
    }
    @media (max-width: 1100px){
      .lab-grid{ grid-template-columns: 1fr; }
    }

    .lab-panel{
      background: var(--lab-card);
      border:1px solid var(--lab-border);
      border-radius: 16px;
      overflow:hidden;
      box-shadow: var(--lab-shadow);
    }

    .panel-top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding: 12px 12px;
      background: linear-gradient(180deg, rgba(0,0,0,.02) 0%, rgba(0,0,0,0) 100%);
      border-bottom:1px solid var(--lab-border);
    }
    body[data-theme="dark"] .panel-top{
      background: linear-gradient(180deg, rgba(255,255,255,.06) 0%, rgba(255,255,255,0) 100%);
    }

    .tabs{
      display:flex;
      gap:8px;
      align-items:center;
    }
    .tab{
      border:1px solid var(--lab-border);
      background: transparent;
      color: inherit;
      font-weight: 900;
      border-radius: 999px;
      padding: 8px 12px;
      cursor:pointer;
      transition:.15s ease;
      font-size: 13px;
    }
    .tab.active{
      background: rgba(255,107,0,.10);
      border-color: rgba(255,107,0,.35);
      color: var(--lab-accent);
      box-shadow: 0 12px 22px rgba(255,107,0,.12);
    }

    .panel-hint{
      font-size: 12px;
      font-weight: 800;
      color: var(--lab-muted);
    }

    /* Editor textarea */
    .codebox{
      width:100%;
      min-height: 520px;
      border:none;
      outline:none;
      resize: vertical;
      padding: 16px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 13px;
      line-height: 1.65;
      background: var(--lab-codebg);
      color: var(--lab-codetext);
    }

    /* Preview */
    .preview-wrap{
      background: var(--lab-soft);
      min-height: 520px;
      padding: 14px;
    }
    .preview-frame{
      width:100%;
      height: 560px;
      border:1px solid var(--lab-border);
      border-radius: 14px;
      background:#fff;
      overflow:hidden;
      box-shadow: 0 18px 40px rgba(0,0,0,.12);
    }
    body[data-theme="dark"] .preview-frame{
      background:#0b1220;
    }

    .mini-row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    /* Header renkleri dark theme için */
    body[data-theme="dark"] .app-header,
    body[data-theme="dark"] .sub-nav{
      background:#0b1220 !important;
      border-color: rgba(255,255,255,.08) !important;
    }
    body[data-theme="dark"] .logo,
    body[data-theme="dark"] .nav-link{
      color:#fff !important;
    }
  </style>
</head>

<body data-theme="corporate">
  <!-- ✅ HOME HEADER (aynı hizaya yakın, linkler relative) -->
  <header class="app-header">
    <div class="container header-inner">
      <div class="header-left">
        <a href="../" class="logo">RGZTEC</a>
      </div>

      <div class="search-bar" style="max-width:520px; opacity:.55; pointer-events:none;">
        <input type="text" class="search-input" placeholder="Editor mode…">
        <button class="search-btn" type="button" aria-label="Search">
          <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
          </svg>
        </button>
      </div>

      <div class="nav-right">
        <a href="../" class="nav-link">Home</a>
        <a href="../seller/login.html" class="nav-link">Sign In</a>
        <a href="../open-store.html" class="btn-open-store">Open Store</a>
      </div>
    </div>
  </header>

  <main class="container lab-wrap">
    <div class="lab-head">
      <div>
        <div class="lab-title">Dashboard / Editor</div>
        <div class="lab-sub">
          Test HTML, CSS and JS blocks exactly inside RGZTEC layout before publishing.
          Use <b>Open Preview</b> to validate a component in a clean new tab.
        </div>
      </div>

      <div class="lab-controls">
        <div class="lab-pill">
          <label for="themeSelect">Theme</label>
          <select id="themeSelect" class="lab-select">
            <option value="corporate" selected>Corporate</option>
            <option value="light">Light</option>
            <option value="dark">Dark</option>
          </select>
        </div>

        <button id="btnCopy" class="lab-btn" type="button">Copy</button>
        <button id="btnReset" class="lab-btn" type="button">Reset</button>
        <button id="btnOpen" class="lab-btn" type="button">Open Preview</button>
        <button id="btnRun" class="lab-btn primary" type="button">Run</button>
      </div>
    </div>

    <div class="lab-grid">
      <!-- EDITOR -->
      <section class="lab-panel">
        <div class="panel-top">
          <div class="tabs">
            <button class="tab active" data-tab="html" type="button">HTML</button>
            <button class="tab" data-tab="css" type="button">CSS</button>
            <button class="tab" data-tab="js" type="button">JS</button>
          </div>
          <div class="panel-hint">Autosave • Safe preview</div>
        </div>

        <textarea id="codeBox" class="codebox" spellcheck="false"></textarea>
      </section>

      <!-- PREVIEW -->
      <section class="lab-panel">
        <div class="panel-top">
          <div class="tabs" style="gap:10px">
            <span style="font-weight:900; letter-spacing:.02em;">Preview</span>
            <span style="font-size:12px; color:var(--lab-muted); font-weight:800;">(sandbox iframe)</span>
          </div>
          <div class="mini-row">
            <button id="btnRefresh" class="lab-btn" type="button">Refresh</button>
          </div>
        </div>

        <div class="preview-wrap">
          <iframe id="previewFrame" class="preview-frame" sandbox="allow-scripts allow-forms allow-modals allow-popups allow-downloads"></iframe>
        </div>
      </section>
    </div>
  </main>

  <footer class="footer" style="margin-top:34px">
    <div class="container footer-inner">
      <div class="footer-brand">
        <div class="footer-logo">RGZTEC</div>
        <p>Premium digital marketplace for code, UI kits and hardware accessories.</p>
      </div>
      <div class="footer-bot">
        <span>© 2025 RGZTEC, Inc. All rights reserved.</span>
        <div class="footer-links">
          <a href="../privacy.html">Privacy</a>
          <a href="../terms.html">Terms</a>
        </div>
      </div>
    </div>
  </footer>

  <script>
    (function(){
      "use strict";

      // ---------------------------
      // Defaults
      // ---------------------------
      const DEFAULTS = {
        theme: "corporate",
        html:
`<div class="rgz-card">
  <div class="rgz-badge">#PREMIUM</div>
  <h3>Hello RGZTEC</h3>
  <p>This is a test component inside RGZTEC layout.</p>
  <button class="rgz-btn">Action</button>
</div>`,
        css:
`.rgz-card{
  background:#fff;
  border-radius:14px;
  padding:18px;
  border:1px solid rgba(0,0,0,.08);
  box-shadow: 0 18px 40px rgba(0,0,0,.10);
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
}
.rgz-badge{
  display:inline-flex;
  padding:6px 10px;
  border-radius:999px;
  font-weight:900;
  font-size:12px;
  background: rgba(255,107,0,.12);
  color:#ff6b00;
  border:1px solid rgba(255,107,0,.25);
}
.rgz-btn{
  margin-top:12px;
  border:none;
  cursor:pointer;
  font-weight:900;
  padding:10px 14px;
  border-radius:999px;
  background: linear-gradient(180deg,#ff7a1a 0%, #ff6b00 100%);
  color:#fff;
  box-shadow: 0 18px 34px rgba(255,107,0,.22);
}`,
        js:
`document.querySelector(".rgz-btn")?.addEventListener("click", ()=>{
  alert("RGZTEC ✅ Component works!");
});`
      };

      const LS_KEY = "rgztec_lab_v1";

      const els = {
        theme: document.getElementById("themeSelect"),
        tabs: Array.from(document.querySelectorAll(".tab")),
        code: document.getElementById("codeBox"),
        frame: document.getElementById("previewFrame"),
        btnRun: document.getElementById("btnRun"),
        btnRefresh: document.getElementById("btnRefresh"),
        btnReset: document.getElementById("btnReset"),
        btnCopy: document.getElementById("btnCopy"),
        btnOpen: document.getElementById("btnOpen"),
      };

      let state = loadState();
      let activeTab = "html";

      // ---------------------------
      // State
      // ---------------------------
      function loadState(){
        try{
          const raw = localStorage.getItem(LS_KEY);
          if(!raw) return structuredClone(DEFAULTS);
          const parsed = JSON.parse(raw);
          return {
            theme: parsed.theme || DEFAULTS.theme,
            html: parsed.html ?? DEFAULTS.html,
            css: parsed.css ?? DEFAULTS.css,
            js: parsed.js ?? DEFAULTS.js
          };
        }catch{
          return structuredClone(DEFAULTS);
        }
      }

      function saveState(){
        try{
          localStorage.setItem(LS_KEY, JSON.stringify(state));
        }catch{}
      }

      function structuredClone(obj){
        return JSON.parse(JSON.stringify(obj));
      }

      // ---------------------------
      // Theme
      // ---------------------------
      function applyTheme(t){
        document.body.setAttribute("data-theme", t);
        state.theme = t;
        saveState();
        runPreview(); // preview da theme ile yenilensin
      }

      // ---------------------------
      // Tabs
      // ---------------------------
      function setTab(tab){
        activeTab = tab;
        els.tabs.forEach(b => b.classList.toggle("active", b.dataset.tab === tab));
        els.code.value = state[tab] || "";
      }

      function updateActiveCode(){
        state[activeTab] = els.code.value;
        saveState();
      }

      // ---------------------------
      // Build preview document
      // ---------------------------
      function buildPreviewDoc({ html, css, js, theme }){
        // Preview için minimal ama kaliteli base
        // (İstersen buraya store-core/home css linklerini de ekleriz; şimdilik isolated)
        const bg = (theme === "dark") ? "#0b1220" : "#f6f7f9";
        const text = (theme === "dark") ? "#ffffff" : "#111827";
        const card = (theme === "dark") ? "#0f1a30" : "#ffffff";
        const border = (theme === "dark") ? "rgba(255,255,255,.12)" : "rgba(0,0,0,.08)";

        return `<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>RGZTEC Preview</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  :root{ color-scheme:${theme==="dark" ? "dark" : "light"}; }
  html,body{ margin:0; padding:0; background:${bg}; color:${text}; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; }
  .preview-shell{ padding:24px; }
  .preview-surface{
    background:${card};
    border:1px solid ${border};
    border-radius:16px;
    padding:22px;
    box-shadow: 0 18px 40px rgba(0,0,0,.12);
  }
  /* küçük global helper */
  a{ color:#ff6b00; font-weight:800; text-decoration:none; }
</style>
<style>${css || ""}</style>
</head>
<body>
  <div class="preview-shell">
    <div class="preview-surface">
      ${html || ""}
    </div>
  </div>

  <script>
    try{
      ${js || ""}
    }catch(e){
      console.error(e);
      const pre = document.createElement("pre");
      pre.style.whiteSpace="pre-wrap";
      pre.style.background="rgba(255,0,0,.08)";
      pre.style.border="1px solid rgba(255,0,0,.25)";
      pre.style.padding="12px";
      pre.style.borderRadius="12px";
      pre.textContent = "JS Error: " + (e && e.message ? e.message : String(e));
      document.body.appendChild(pre);
    }
  <\/script>
</body>
</html>`;
      }

      // ---------------------------
      // Preview actions
      // ---------------------------
      function runPreview(){
        const doc = buildPreviewDoc({
          html: state.html,
          css: state.css,
          js: state.js,
          theme: state.theme
        });
        els.frame.srcdoc = doc;
      }

      function openPreviewNewTab(){
        const doc = buildPreviewDoc({
          html: state.html,
          css: state.css,
          js: state.js,
          theme: state.theme
        });
        const w = window.open("", "_blank");
        if(!w){
          alert("Pop-up blocked. Please allow pop-ups for this site.");
          return;
        }
        w.document.open();
        w.document.write(doc);
        w.document.close();
      }

      // ---------------------------
      // Buttons
      // ---------------------------
      els.btnRun.addEventListener("click", () => {
        updateActiveCode();
        runPreview();
      });

      els.btnRefresh.addEventListener("click", () => {
        runPreview();
      });

      els.btnReset.addEventListener("click", () => {
        if(!confirm("Reset editor to default template?")) return;
        state = structuredClone(DEFAULTS);
        saveState();
        els.theme.value = state.theme;
        applyTheme(state.theme);
        setTab(activeTab);
        runPreview();
      });

      els.btnCopy.addEventListener("click", async () => {
        updateActiveCode();
        const payload =
`<!-- HTML -->
${state.html}

<!-- CSS -->
<style>
${state.css}
</style>

<!-- JS -->
<script>
${state.js}
</script>`;
        try{
          await navigator.clipboard.writeText(payload);
          els.btnCopy.textContent = "Copied ✓";
          setTimeout(()=> els.btnCopy.textContent="Copy", 900);
        }catch{
          alert("Copy failed (clipboard blocked).");
        }
      });

      els.btnOpen.addEventListener("click", () => {
        updateActiveCode();
        openPreviewNewTab();
      });

      // Tabs change
      els.tabs.forEach(btn => {
        btn.addEventListener("click", () => {
          updateActiveCode();
          setTab(btn.dataset.tab);
        });
      });

      // Autosave typing
      els.code.addEventListener("input", () => {
        updateActiveCode();
      });

      // Theme change
      els.theme.addEventListener("change", (e) => {
        applyTheme(e.target.value);
      });

      // Init
      els.theme.value = state.theme || DEFAULTS.theme;
      applyTheme(els.theme.value);
      setTab("html");
      runPreview();

    })();
  </script>
</body>
</html>

