<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RGZTEC • Seller Sign-In</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet" />

  <!-- Ana site dili -->
  <link rel="stylesheet" href="../assets/css/home.css" />
  <!-- Seller premium -->
  <link rel="stylesheet" href="../assets/css/seller-login.css" />
</head>

<body class="rgz-seller-auth">

  <header class="rgz-header">
    <div class="rgz-header__inner">
      <a class="rgz-brand" href="../index.html" aria-label="RGZTEC Home">
        <span class="rgz-brand__name">RGZTEC</span>
      </a>

      <nav class="rgz-nav">
        <a class="rgz-nav__link" href="../store/">Store</a>
        <a class="rgz-nav__link is-active" href="./login.html">Seller</a>
        <a class="rgz-nav__link" href="../lab/">LAB</a>
      </nav>
    </div>
  </header>

  <main class="seller-shell">
    <section class="seller-card" aria-label="Seller login">

      <div class="seller-badge">SECURE SELLER ACCESS</div>

      <h1>Seller Sign-In</h1>
      <p class="seller-sub">
        Satıcı paneline güvenli giriş. <br>
        Seller ID + Access Key ile doğrulanır.
      </p>

      <form class="seller-form" id="sellerForm">
        <label>
          <span>Seller ID</span>
          <input id="sellerId" name="sellerId" type="text" autocomplete="username" placeholder="e.g. acme-store" required />
        </label>

        <label>
          <span>Access Key</span>
          <input id="accessKey" name="accessKey" type="password" autocomplete="current-password" placeholder="RGZ-XXXX-XXXX" required />
        </label>

        <button class="seller-btn" id="btnLogin" type="submit">
          <span class="seller-btn__txt">Giriş Yap</span>
          <span class="seller-btn__spinner" aria-hidden="true"></span>
        </button>

        <div class="seller-msg" id="msg" role="status" aria-live="polite"></div>
      </form>

      <div class="seller-foot">
        <span>Satıcı değil misin?</span>
        <a href="../open-store.html">Seller başvurusu yap</a>
      </div>

      <div class="seller-note">
        Endpoint: <code id="endpointText">/api/seller/login</code>
      </div>
    </section>
  </main>

  <script>
    // =========================================================
    // RGZTEC Seller Login • API Connected
    // - POST /api/seller/login
    // - expects: { sellerId, accessKey }
    // - returns: { token, sellerId, role, expiresIn? } (senin API ne dönüyorsa)
    // =========================================================

    const form = document.getElementById("sellerForm");
    const sellerIdEl = document.getElementById("sellerId");
    const accessKeyEl = document.getElementById("accessKey");
    const btn = document.getElementById("btnLogin");
    const msg = document.getElementById("msg");

    // Deploy’e göre override edebilmen için:
    // window.RGZ_API_BASE = "https://yourdomain.com" gibi set edebilirsin.
    const API_BASE = (window.RGZ_API_BASE || "").replace(/\/+$/, "");
    const ENDPOINT = (API_BASE ? API_BASE : "") + "/api/seller/login";
    document.getElementById("endpointText").textContent = ENDPOINT;

    function setLoading(on){
      btn.disabled = on;
      btn.classList.toggle("is-loading", on);
    }
    function setMsg(text, type){
      msg.textContent = text || "";
      msg.className = "seller-msg" + (type ? (" is-" + type) : "");
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      setMsg("", "");
      setLoading(true);

      const sellerId = (sellerIdEl.value || "").trim();
      const accessKey = (accessKeyEl.value || "").trim();

      if(!sellerId || !accessKey){
        setLoading(false);
        return setMsg("Seller ID ve Access Key zorunlu.", "warn");
      }

      try{
        const res = await fetch(ENDPOINT, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ sellerId, accessKey })
        });

        const data = await res.json().catch(() => ({}));

        if(!res.ok){
          // API’nin döndürdüğü hata formatına göre uyumlu
          const err = data?.error || data?.message || ("Login failed (" + res.status + ")");
          setLoading(false);
          return setMsg(err, "error");
        }

        // Token field adını senin API’ye göre esnek yakalayalım
        const token = data?.token || data?.accessToken || data?.jwt;
        if(!token){
          setLoading(false);
          return setMsg("Token alınamadı. API response kontrol.", "error");
        }

        // ✅ Session
        const session = {
          token,
          sellerId: data?.sellerId || sellerId,
          role: data?.role || "seller",
          ts: Date.now()
        };
        localStorage.setItem("rgz_seller_session", JSON.stringify(session));

        setMsg("Giriş başarılı. Yönlendiriliyor…", "ok");

        // ✅ Dashboard route (senin sistemine göre ayarla)
        // Örn: ../seller/dashboard.html veya ../apps/seller/ vb.
        const next = "../seller/index.html"; // değiştir: panel sayfan neredeyse
        setTimeout(() => location.href = next, 450);

      }catch(err){
        setLoading(false);
        setMsg("Network/API error: " + (err?.message || String(err)), "error");
      }
    });
  </script>
</body>
</html>

